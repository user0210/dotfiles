#!/bin/bash

# systemctl --user mask .... prevents system to start automaticly

start_pipe () {
	killall alsamixer
	systemctl --user start --now pipewire.{socket,service} &&
	systemctl --user start --now pipewire-pulse.{socket,service}
	notify-send "pipewire enabled"
}

start_alsa () {
	killall pavucontrol
	systemctl --user stop --now pipewire.{socket,service} &&
	systemctl --user stop --now pipewire-pulse.{socket,service} &&
	alsactl restore
	notify-send "pipewire disabled"
}
case "$1" in
	-s) ## toggle between alsa or pipewire as backend
		pon=$(pgrep pipewire)
		if [ -z "$pon" ] ;then
			start_pipe
		else
			start_alsa
		fi
		kill -35 $(pidof dwmblocks) ;;

	-o) ## open alsamixer or pavucontrol depending on backend in dwm
		pon=$(pgrep pipewire)
		if [ -z "$pon" ] ;then
			killall alsamixer || xsetroot -name 'dwm:cmd alsam'
		else
			killall pavucontrol || xsetroot -name 'dwm:cmd pulsm'
		fi
		kill -35 $(pidof dwmblocks) ;;

	pipe) ## select pipewire as backend
		start_pipe ;;

	alsa) ## select alsa as backend
		start_alsa ;;
esac
